<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji to Image</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <h3>emojiç‚¹é˜µè½¬æ¢æµ‹è¯•å·¥å…·ï¼Œè¯·åœ¨devtoolsä¸­è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º</h3>
    <p>This tool use canvas to dump emoji fonts to a rgb binary file. Result file can be used in embedded systems.</p>
    <p>ç”¨canvasè½¬æ¢emojiçš„å›¾æ ‡ä¸ºrgbäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ç”¨äºå„ç§åµŒå…¥å¼ç•Œé¢å¼€å‘ã€‚</p>
    <p>æ¯ä¸ªiconçš„æ˜ åƒå¯ä»¥å•ç‹¬ä¸‹è½½ï¼Œå…¶ä¸­åªå«æœ‰RGBåºåˆ—æ•°æ®ã€‚åˆé›†æ–‡ä»¶åœ¨æ¯ä¸€ä¸ªæ˜ åƒä¹‹å‰æœ‰ä¸€ä¸ªå¤´éƒ¨ï¼Œç»“æ„å¦‚ä¸‹ã€‚</p>
    <pre>
        ...
        uint32 0x4A4F4D45;  //MAGIC: EMOJ
        uint32 codepoint;
        uint16 width;
        uint16 height;
        uint32 0x12345678;  //endian indicator
        R G B R G B ...  #24x24 ç»„ RGB
        ...

        # 24x24emoji: 16 + 24x24x3 = 1744 bytes

    </pre>
    <p>ä¹Ÿæ”¯æŒè¾“å‡ºå…¶ä»–å°ºå¯¸çš„ç‚¹é˜µï¼Œå¯ä»¥ä¿®æ”¹font_heightå’Œfont_widthã€‚ä¿®æ”¹åï¼Œæ³¨æ„çœ‹ä¸€ä¸‹consoleè¾“å‡ºçš„å­—ç¬¦å›¾åƒæ˜¯å¦åˆç†ã€‚</p>

    <canvas id="emojiCanvas" width="512" height="32"></canvas>
    <script>
        //æœ‰è‡ªå·±çš„emoji è¯·æ”¾åœ¨è¿™é‡Œ
        const emojis = "âŒšâŒ›â©âªâ«â¬â°â³â˜”â˜•â˜â™ˆâ™‰â™Šâ™‹â™Œâ™â™â™â™â™‘â™’â™“âš“âš¡âšªâš«âš½âš¾â›…â›â›”â›ªâ›²â›³â›µâ›½âœ…âœŠâœ‹âœŒâœâŒââ“â”â•â—â•â–â—â°â¿â¬›â¬œâ­â­•ğŸ€„ğŸ…°ğŸ…±ğŸ…¾ğŸ…¿ğŸ†ğŸ†‘ğŸ†’ğŸ†“ğŸ†”ğŸ†•ğŸ†–ğŸ†—ğŸ†˜ğŸ†™ğŸ†šğŸˆğŸˆšğŸˆ¯ğŸˆ²ğŸˆ³ğŸˆ´ğŸˆµğŸˆ¶ğŸˆ¸ğŸˆ¹ğŸˆºğŸ‰ğŸ‰‘ğŸŒ€ğŸŒğŸŒ‚ğŸŒƒğŸŒ†ğŸŒ‡ğŸŒ‰ğŸŒŠğŸŒ‹ğŸŒŒğŸŒğŸŒğŸŒğŸŒğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒ™ğŸŒšğŸŒ›ğŸŒœğŸŒğŸŒğŸŒŸğŸŒ ğŸŒ°ğŸŒ±ğŸŒ²ğŸŒ³ğŸŒ´ğŸŒµğŸŒ·ğŸŒ¸ğŸŒ¹ğŸŒºğŸŒ»ğŸŒ¼ğŸŒ½ğŸŒ¾ğŸŒ¿ğŸ€ğŸğŸ‚ğŸƒğŸ„ğŸ…ğŸ†ğŸ‡ğŸˆğŸ‰ğŸŠğŸ‹ğŸŒğŸğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ€ğŸğŸ‚ğŸ…ğŸˆğŸ‰ğŸŠğŸŒğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¥ğŸ¦ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸ·ğŸ¸ğŸºğŸ»ğŸ½ğŸ¾ğŸ¿ğŸ€ğŸ‚ğŸƒğŸ„ğŸ†ğŸ‡ğŸˆğŸ‰ğŸŠğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ€ğŸğŸ‚ğŸƒğŸ„ğŸ…ğŸ†ğŸ‡ğŸˆğŸ‰ğŸŠğŸ‹ğŸŒğŸğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ‘€ğŸ‘‚ğŸ‘ƒğŸ‘„ğŸ‘…ğŸ‘†ğŸ‘‡ğŸ‘ˆğŸ‘‰ğŸ‘ŠğŸ‘‹ğŸ‘ŒğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘‘ğŸ‘’ğŸ‘“ğŸ‘”ğŸ‘•ğŸ‘–ğŸ‘—ğŸ‘˜ğŸ‘™ğŸ‘šğŸ‘›ğŸ‘œğŸ‘ğŸ‘ğŸ‘ŸğŸ‘ ğŸ‘¡ğŸ‘¢ğŸ‘£ğŸ‘¤ğŸ‘¥ğŸ‘¦ğŸ‘§ğŸ‘¨ğŸ‘©ğŸ‘ªğŸ‘«ğŸ‘¬ğŸ‘­ğŸ‘®ğŸ‘¯ğŸ‘°ğŸ‘±ğŸ‘²ğŸ‘³ğŸ‘´ğŸ‘µğŸ‘¶ğŸ‘·ğŸ‘¸ğŸ‘¹ğŸ‘ºğŸ‘»ğŸ‘¼ğŸ‘½ğŸ‘¾ğŸ‘¿ğŸ’€ğŸ’ğŸ’‚ğŸ’ƒğŸ’„ğŸ’…ğŸ’†ğŸ’‡ğŸ’ˆğŸ’‰ğŸ’ŠğŸ’‹ğŸ’ŒğŸ’ğŸ’ğŸ’ğŸ’ğŸ’‘ğŸ’’ğŸ’“ğŸ’”ğŸ’•ğŸ’–ğŸ’—ğŸ’˜ğŸ’™ğŸ’šğŸ’›ğŸ’œğŸ’ğŸ’ğŸ’ŸğŸ’ ğŸ’¡ğŸ’¢ğŸ’£ğŸ’¤ğŸ’¦ğŸ’§ğŸ’¨ğŸ’©ğŸ’ªğŸ’¬ğŸ’­ğŸ’®ğŸ’¯ğŸ’°ğŸ’³ğŸ’´ğŸ’µğŸ’¶ğŸ’·ğŸ’¸ğŸ’ºğŸ’»ğŸ’¼ğŸ’½ğŸ’¾ğŸ’¿ğŸ“€ğŸ“ğŸ“‚ğŸ“ƒğŸ“„ğŸ“…ğŸ“†ğŸ“‡ğŸ“ˆğŸ“‰ğŸ“ŠğŸ“‹ğŸ“ŒğŸ“ğŸ“ğŸ“ğŸ“ğŸ“‘ğŸ““ğŸ“”ğŸ“•ğŸ“–ğŸ“—ğŸ“˜ğŸ“™ğŸ“šğŸ“›ğŸ“œğŸ“ğŸ“ğŸ“ŸğŸ“ ğŸ“¡ğŸ“¢ğŸ“£ğŸ“¤ğŸ“¥ğŸ“¦ğŸ“§ğŸ“¨ğŸ“©ğŸ“ªğŸ“«ğŸ“¬ğŸ“­ğŸ“®ğŸ“¯ğŸ“°ğŸ“±ğŸ“²ğŸ“³ğŸ“´ğŸ“¶ğŸ“·ğŸ“¹ğŸ“ºğŸ“»ğŸ“¼ğŸ”€ğŸ”ğŸ”‚ğŸ”ƒğŸ”„ğŸ”…ğŸ”†ğŸ”‡ğŸ”ˆğŸ”‰ğŸ”ŠğŸ”‹ğŸ”ŒğŸ”ğŸ”ğŸ”ğŸ”ğŸ”‘ğŸ”’ğŸ”“ğŸ””ğŸ”•ğŸ”–ğŸ”—ğŸ”™ğŸ”šğŸ”›ğŸ”œğŸ”ğŸ”ğŸ” ğŸ”¡ğŸ”¢ğŸ”£ğŸ”¤ğŸ”¥ğŸ”¦ğŸ”§ğŸ”¨ğŸ”©ğŸ”ªğŸ”«ğŸ”¬ğŸ”­ğŸ”®ğŸ”¯ğŸ”°ğŸ”±ğŸ”²ğŸ”³ğŸ”´ğŸ”µğŸ”¶ğŸ”·ğŸ”¸ğŸ”¹ğŸ”ºğŸ”»ğŸ”¼ğŸ”½ğŸ—»ğŸ—¼ğŸ—½ğŸ—¿ğŸ˜€ğŸ˜ğŸ˜‚ğŸ˜ƒğŸ˜„ğŸ˜…ğŸ˜†ğŸ˜‡ğŸ˜ˆğŸ˜‰ğŸ˜ŠğŸ˜‹ğŸ˜ŒğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜‘ğŸ˜’ğŸ˜“ğŸ˜”ğŸ˜•ğŸ˜–ğŸ˜—ğŸ˜˜ğŸ˜™ğŸ˜šğŸ˜›ğŸ˜œğŸ˜ğŸ˜ğŸ˜ŸğŸ˜ ğŸ˜¡ğŸ˜¢ğŸ˜£ğŸ˜¤ğŸ˜¥ğŸ˜¦ğŸ˜§ğŸ˜¨ğŸ˜ªğŸ˜«ğŸ˜¬ğŸ˜­ğŸ˜®ğŸ˜¯ğŸ˜°ğŸ˜±ğŸ˜²ğŸ˜³ğŸ˜´ğŸ˜µğŸ˜¶ğŸ˜·ğŸ˜¸ğŸ˜¹ğŸ˜ºğŸ˜»ğŸ˜¼ğŸ˜½ğŸ˜¾ğŸ˜¿ğŸ™€ğŸ™…ğŸ™†ğŸ™‡ğŸ™ˆğŸ™‰ğŸ™ŠğŸ™‹ğŸ™ŒğŸ™ğŸ™ğŸ™ğŸš€ğŸšğŸš‚ğŸšƒğŸš„ğŸš…ğŸš†ğŸš‡ğŸšˆğŸš‰ğŸšŠğŸš‹ğŸšŒğŸšğŸšğŸšğŸšğŸš‘ğŸš’ğŸš“ğŸš”ğŸš•ğŸš–ğŸš—ğŸš˜ğŸššğŸš›ğŸšœğŸšğŸšğŸšŸğŸš ğŸš¡ğŸš¢ğŸš£ğŸš¤ğŸš¥ğŸš¦ğŸš§ğŸš¨ğŸš©ğŸšªğŸš«ğŸš¬ğŸš­ğŸš®ğŸš¯ğŸš°ğŸš±ğŸš²ğŸš³ğŸš´ğŸšµğŸš¶ğŸš·ğŸš¸ğŸš¹ğŸšºğŸš»ğŸš¼ğŸš½ğŸš¾ğŸš¿ğŸ›€ğŸ›ğŸ›‚ğŸ›ƒğŸ›„ğŸ›…ğŸ¦‹";

        //const emojis = "ğŸ˜€ğŸ˜";

        const font_height = font_width = 24; //æƒ³è¦ä¿®æ”¹è¾“å‡ºiconå°ºå¯¸ï¼Œä¿®æ”¹è¿™é‡Œï¼Œå¹¶ä¸”ä¿®æ”¹ canvasCtx.font å­—ä½“ä¹Ÿè°ƒå¤§ä¸€ç‚¹ã€‚
        // è·å– Canvas ä¸Šä¸‹æ–‡å¯¹è±¡
        var canvas = document.getElementById('emojiCanvas');
        var canvasCtx = canvas.getContext('2d');
        // è®¾ç½®å…¨å±€é€æ˜åº¦ä¸º0ï¼Œä½¿å¾— Canvas å…¨éƒ¨å†…å®¹å˜ä¸ºé€æ˜
        //canvasCtx.globalAlpha = 0;
        canvasCtx.font = '20px Arial'; // è®¾ç½®å­—ä½“å’Œå¤§å°
        canvasCtx.textBaseline = 'middle';
        canvasCtx.textAlign = 'center';
        canvasCtx.fillStyle = 'black';
        canvasCtx.willReadFrequently = true;
        // æ¢å¤å…¨å±€é€æ˜åº¦
        //canvasCtx.globalAlpha = 1;


        //return in form: 0000ABCD
        function charToUnicodeStr(character) {
            var unicode = character.codePointAt(0);
            var hexString = unicode.toString(16).toUpperCase().padStart(8, '0');
            return hexString;
        }

        function numToByteStr(number) {
            // å°†æ•°å­—é™åˆ¶åœ¨ 0 åˆ° 255 ä¹‹é—´
            var clampedNumber = Math.max(0, Math.min(255, number));
            // å–æ•´æ•°éƒ¨åˆ†å¹¶è½¬æ¢ä¸ºä¸¤ä½åå…­è¿›åˆ¶å½¢å¼
            var integerPart = Math.floor(clampedNumber);
            var hexString = integerPart.toString(16).toUpperCase().padStart(2, '0');
            return hexString;
        }

        function numToByte(number) {
            // å°†æ•°å­—é™åˆ¶åœ¨ 0 åˆ° 255 ä¹‹é—´
            var clampedNumber = Math.max(0, Math.min(255, number));
            // å–æ•´æ•°éƒ¨åˆ†å¹¶è½¬æ¢ä¸ºä¸¤ä½åå…­è¿›åˆ¶å½¢å¼
            return Math.floor(clampedNumber);
        }

        function generateEmojiMatrix(emojiText) {
            console.log(emojiText + "unicode code point is:0x" + charToUnicodeStr(emojiText));

            // æ¸…ç©º Canvas
            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

            canvasCtx.fillText(emojiText, canvas.width / 2, canvas.height / 2);

            // è·å–å›¾åƒçš„åƒç´ æ•°æ®
            var imageData = canvasCtx.getImageData((canvas.width - font_width)/ 2 , (canvas.height - font_height)/ 2 , font_width , font_height);
            var pixels = imageData.data;

            var pixelRGBString = '';
            const pixelRGBArray = [];

            // è¾“å‡ºç‚¹é˜µæ•°æ®
            for (var y = 0; y < font_height; y++) {
                var row = '|';
                for (var x = 0; x < font_width; x++) {
                    var index = (y * font_width + x) * 4;
                    var r = pixels[index];
                    var g = pixels[index + 1];
                    var b = pixels[index + 2];
                    var alpha = pixels[index + 3];
                    r *= alpha / 256;
                    g *= alpha / 256;
                    b *= alpha / 256;

                    var gray = (r + g + b) / 3;
                    if (gray < 5) {
                        row += '  ';
                    } else if (gray < 64) {
                        row += '..';
                    } else if (gray < 128) {
                        row += '||';
                    } else if (gray < 192) {
                        row += '++';
                    } else {
                        row += '##';
                    }

                    pixelRGBString += numToByteStr(r) + numToByteStr(g) + numToByteStr(b);

                    pixelRGBArray.push(numToByte(r));
                    pixelRGBArray.push(numToByte(g));
                    pixelRGBArray.push(numToByte(b));

                }
                console.log(row + '|');
            }

            const codePointStr = charToUnicodeStr(emojiText);

            return {
                codePointStr,
                encoding: emojiText.codePointAt(0),
                height: font_height,
                width: font_width,
                rgbData: pixelRGBArray,
                rgbString: pixelRGBString
            }

        }

        const emjlist = Array.from(emojis);

        //é€šè¿‡unicodeæ•°å€¼å¤§å°ï¼Œå‡åºæ’åˆ—
        emjlist.sort(function(a,b){
            r = a.codePointAt(0) - b.codePointAt(0);
            if(r == 0)console.log(a + "é‡å¤");
            return r;
        })

        //ä¸‹é¢å¼€å§‹é‡‡æ ·è¾“å‡º
        const output = [];
        for (var i = 0; i < emjlist.length; i++) {

            const emj = emjlist[i];
            const ret = generateEmojiMatrix(emj);
            const fontSize = ret.width * ret.height * 3;

            //8 ä¸ªä¸€ç»„,ç»„ç»‡å¯ä»¥ç›´æ¥ä¸‹è½½çš„RGB äºŒè¿›åˆ¶æ–‡ä»¶.
            if (i % 8 == 0)
                document.body.appendChild(document.createElement('br'));

            const blob = new Blob([new Uint8Array(ret.rgbData)], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'emj' + ret.width + '_' + ret.codePointStr;
            link.innerHTML = ' ã€' + emj + 'ã€‘' + ret.codePointStr;
            document.body.appendChild(link);
            //link.click(); å†…å®¹å¤ªå¤š åˆ«è‡ªåŠ¨ä¸‹è½½

            //document.body.removeChild(link);
            //URL.revokeObjectURL(url);

            //ç»„ç»‡å½“å‰fontå¤´éƒ¨,æ ¼å¼çœ‹ç½‘é¡µå¼€å¤´è¯´æ˜
            var fontHeadByteArray = new Uint8Array(16);
            var dataView = new DataView(fontHeadByteArray.buffer);
            dataView.setUint32(0, 0x4A4F4D45, true);    //little endian "EMOJ"
            dataView.setUint32(4, ret.encoding, true);
            dataView.setUint16(8, ret.width, true);
            dataView.setUint16(10, ret.height, true);
            dataView.setUint32(12, 0xdeadbeef, true);

            //åŠ å…¥è¾“å‡º
            output.push(...Array.from(fontHeadByteArray));

            //fontå†…å®¹è¾“å‡º
            output.push(...ret.rgbData);

        }

        document.body.appendChild(document.createElement('hr'));

        //è¾“å‡ºå¤§fontæ–‡ä»¶ ä¸‹è½½
        const blob = new Blob([new Uint8Array(output)], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'emj' + font_width + 'x' + font_height + '_' + emjlist.length;
        link.innerHTML = ' ã€' + emjlist.length + 'ä¸ªemojiåˆé›†äºŒè¿›åˆ¶æ˜ åƒä¸‹è½½ã€‘';
        document.body.appendChild(link);


        console.log("å‡åºæ’åˆ—çš„emojiå¦‚ä¸‹ï¼Œå¯ä»¥æŸ¥é‡ä¼˜åŒ–");
        console.log(emjlist.join(''));

    </script>
</body>

</html>